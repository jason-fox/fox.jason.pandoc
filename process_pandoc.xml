<?xml version="1.0" encoding="UTF-8"?><!--ant--><!--
	This file is part of the DITA-OT Pandoc Plug-in project.
	See the accompanying LICENSE file for applicable licenses.
-->
<project name="fox.jason.passthrough.pandoc" xmlns:if="ant:if" xmlns:unless="ant:unless">

	<!--
		Individual file processing for pandoc.
		Take an input format run pandoc against it and convert to DITA

		@param src - The input file to convert to DITA
		@param dest - The output file location
		@param title - The title of the converted file
	-->
	<macrodef name="add-pandoc-file">
		<attribute name="src" />
		<attribute name="dest" />
		<attribute name="title" />
		<sequential>
			<local name="pandoc.error"/>
			<local name="pandoc.message.code"/>
			<echo if:set="pandoc.installed" taskname="pandoc" level="info" message="Processing @{src}" />
			<!-- For Unix run Pandoc as an executable -->
			<exec executable="pandoc" dir="${dita.temp.dir}" osfamily="unix" taskname="pandoc" errorproperty="pandoc.error" >
				<arg line="&quot;@{src}&quot;  -t ${dita.plugin.fox.jason.passthrough.pandoc.dir}/resource/topic.lua -o  @{dest} -M title=&quot;@{title}&quot;"/>
			</exec>
			<!-- For Windows run from a DOS command -->
			<exec if:set="pandoc.installed" executable="cmd" dir="${dita.temp.dir}" osfamily="windows" taskname="pandoc" errorproperty="pandoc.error">
				<arg value="/C"/>
				<arg value="pandoc &quot;@{src}&quot;  -t ${dita.plugin.fox.jason.passthrough.pandoc.dir}/resource/topic.lua -o @{dest} -M title=&quot;@{title}&quot;"/>
			</exec>

			<condition property="pandoc.message.code" value="PAND002W">
				<contains string="${pandoc.error}" substring="Multiple Root Nodes detected."/>
			</condition>

			<dita-ot-echo if:set="pandoc.message.code" id="${pandoc.message.code}">
				<param name="1" value="@{src}"/>
			</dita-ot-echo>
			<!--copy file="@{dest}" tofile="${output.dir}/test.xml"/-->
		</sequential>
	</macrodef>

	
	<!--
		Setting up Pandoc processing. Check that Pandoc is installed
	-->
	<target name="pandoc.check">
		<!-- For Unix run Pandoc as an executable -->
		<exec executable="pandoc" dir="${dita.temp.dir}" osfamily="unix" taskname="pandoc"
			resultproperty="pandoc.result" outputproperty="pandoc.out" failonerror="false" failifexecutionfails="false">
			<arg line="-v"/>
		</exec>
		<!-- For Windows run from a DOS command -->
		<exec executable="cmd" dir="${dita.temp.dir}" osfamily="windows" taskname="pandoc"
			resultproperty="pandoc.result" outputproperty="pandoc.out" failonerror="false" failifexecutionfails="false">
			<arg value="/C"/>
			<arg value="pandoc -v"/>
		</exec>

		<condition property="pandoc.installed">
			<equals arg1="${pandoc.result}" arg2="0"/>
		</condition>

		<dita-ot-echo unless:set="pandoc.installed" id="PAND001W"/>
		<echo if:set="pandoc.installed"  taskname="pandoc" level="info" message="${pandoc.out}"/>
	</target>

	<!--
		Iterate across all files marked format="pandoc" and process them
	-->
	<target name="pandoc.process">
		<passthrough-iterate format="pandoc" macro="add-pandoc-file"/>
	</target>
</project>