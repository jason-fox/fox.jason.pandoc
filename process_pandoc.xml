<?xml version="1.0" encoding="UTF-8"?><!--ant--><!--
	This file is part of the DITA-OT Pandoc Plug-in project.
	See the accompanying LICENSE file for applicable licenses.
-->
<project name="fox.jason.passthrough.pandoc" xmlns:if="ant:if" xmlns:unless="ant:unless">

	

	<target name="check-pandoc">
		<!-- For Unix run Pandoc as an executable -->
		<exec executable="pandoc" dir="${dita.temp.dir}" osfamily="unix" taskname="pandoc"
			resultproperty="pandoc.result" outputproperty="pandoc.out" failonerror="false" failifexecutionfails="false">
			<arg line="-v"/>
		</exec>
		<!-- For Windows run from a DOS command -->
		<exec executable="cmd" dir="${dita.temp.dir}" osfamily="windows" taskname="pandoc"
			resultproperty="pandoc.result" outputproperty="pandoc.out" failonerror="false" failifexecutionfails="false">
			<arg value="/C"/>
			<arg value="pandoc -v"/>
		</exec>

		<condition property="pandoc.installed">
			<equals arg1="${pandoc.result}" arg2="0"/>
		</condition>

		<dita-ot-echo unless:set="pandoc.installed" id="PAND001W"/>
		<echo if:set="pandoc.installed"  taskname="pandoc" level="info" message="${pandoc.out}"/>

		<!--
	
			Converts a file path into a document title
		
			@param  path -   The filename to convert
			@param  to -  The property to set
	
		-->
		<scriptdef language="javascript" name="get-pandoc-title" src="${dita.plugin.fox.jason.passthrough.pandoc.dir}/resource/get-title.js">
			<attribute name="path" />
			<attribute name="to" />
		</scriptdef>
	</target>


	<target name="run-pandoc">
		<macrodef name="pandoc-file">
			<attribute name="src" />
			<attribute name="dest" />
			<sequential>
				<echo if:set="pandoc.installed" taskname="pandoc" level="info" message="Processing @{src}"/>
				<local name="doc.title"/>

				<get-pandoc-title path="@{src}" to="doc.title"/>
				<!-- For Unix run Pandoc as an executable -->
				<exec executable="pandoc" dir="${dita.temp.dir}" osfamily="unix" taskname="pandoc">
					<arg line="&quot;@{src}&quot;  -t ${dita.plugin.fox.jason.passthrough.pandoc.dir}/resource/topic.lua -o  @{dest} -M title=&quot;${doc.title}&quot;"/>
				</exec>
				<!-- For Windows run from a DOS command -->
				<exec executable="cmd" dir="${dita.temp.dir}" osfamily="windows" taskname="pandoc">
					<arg value="/C"/>
					<arg value="pandoc &quot;@{src}&quot;  -t ${dita.plugin.fox.jason.passthrough.pandoc.dir}/resource/topic.lua -o @{dest} -M title=&quot;${doc.title}&quot;"/>
				</exec>
			</sequential>
		</macrodef>
		<passthrough-iterate format="pandoc" macro="pandoc-file"/>
	</target>
</project>